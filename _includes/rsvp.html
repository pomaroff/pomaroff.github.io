<script>
    window.recaptcha_onload = function() {
        document.getElementById('rsvp-form').addEventListener('submit', function(e) {
            event.preventDefault(); //prevent form submit before captcha is completed

            grecaptcha.ready(function() {
                grecaptcha.execute('{{ site.rsvp_captcha }}', {action: 'submit_rsvp'}).then(function(token) {
                    $('#rsvp-form').prepend('<input type="hidden" name="token" value="' + token + '">');
                    $('#rsvp-form').prepend('<input type="hidden" name="action" value="submit_rsvp">');
                    $('#rsvp-form').unbind('submit').submit();
                });
            });
        });

        document.getElementById("rsvp-form-submit").disabled = false;
    }
</script>

<script async src="https://www.google.com/recaptcha/api.js?onload=recaptcha_onload"></script>

<section id="rsvp" class="wrapper style4">
    <div class="inner">
        <header>
            <h2>RSVP</h2>
            <p>Please let us know if you can make it by <b>{{ site.rsvp_date }}</b>.</p>
        </header>

        <form id="rsvp-form" method="post" action="{{ site.rsvp_post }}">
            <div class="row uniform">
                <div class="12u">
                    <input type="text" name="full-name" id="full-name" value="" placeholder="Full name" required />
                </div>
                <div class="12u">
                    <input type="email" name="email" id="email" value="" placeholder="Email address" required />
                </div>
                <div class="12u">
                    <input type="radio" id="attending" name="attending" required>
                    <label for="attending">I will be attending</label>
                </div>
                <div class="12u">
                    <input type="radio" id="not-attending" name="attending">
                    <label for="not-attending">I send my apologies</label>
                </div>
            </div>
            <div id="attending-form" style="display: none;">
                <div class="row uniform">
                    <div class="12u">
                        <textarea name="dietary-requirements" id="dietary-requirements" placeholder="Dietary requirements (if any)" rows="2"></textarea>
                    </div>
                    <div class="12u">
                        <input type="checkbox" id="bringing-a-plus-one" name="bringing-a-plus-one">
                        <label for="bringing-a-plus-one">I'm bringing a plus one</label>
                    </div>
                </div>
                <div class="row uniform" id="plus-one-form" style="display: none;">
                    <div class="12u">
                        <input type="text" name="plus-one-full-name" id="plus-one-full-name" value="" placeholder="Their full name" />
                    </div>
                    <div class="12u">
                        <textarea name="plus-one-dietary-requirements" id="plus-one-dietary-requirements" placeholder="Their dietary requirements (if any)" rows="2"></textarea>
                    </div>
                </div>
                <div class="row uniform">
                    <div class="12u">
                        <input type="checkbox" id="bringing-children" name="bringing-children">
                        <label for="bringing-children">I'm bringing my children</label>
                    </div>
                </div>
                <div class="row uniform" id="children-form" style="display: none;">
                    <div class="12u">
                        <textarea name="children-full-names" id="children-full-names" value="" placeholder="Their full name(s)" rows="2"></textarea>
                    </div>
                    <div class="12u">
                        <textarea name="children-dietary-requirements" id="children-dietary-requirements" placeholder="Their dietary requirements (if any)" rows="2"></textarea>
                    </div>
                    <div class="12u">
                        <input type="text" name="children-high-chairs" id="children-high-chairs" value="" placeholder="Do you need any high chairs?" />
                    </div>
                </div>
            </div>
            <div class="row uniform">
                <div class="12u">
                    <textarea name="message" id="message" placeholder="Anything else we should know?" rows="6"></textarea>
                </div>
                <div class="12u">
                    <ul class="actions">
                        <li><input id="rsvp-form-submit" type="submit" value="Send RSVP" class="special" disabled /></li>
                        <li><input type="reset" value="Reset" id="reset-rsvp-form" /></li>
                    </ul>
                </div>
            </div>
        </form>
    </div>
</section>

<script>
    document.getElementById('attending').addEventListener('click', function(e) {
        if (e.srcElement.checked) {
            document.getElementById('attending-form').style.display = "block";
        } else {
            document.getElementById('attending-form').style.display = "none";
        }
    });

    document.getElementById('not-attending').addEventListener('click', function(e) {
        if (e.srcElement.checked) {
            document.getElementById('attending-form').style.display = "none";
        } else {
            document.getElementById('attending-form').style.display = "block";
        }
    });

    document.getElementById('bringing-a-plus-one').addEventListener('click', function(e) {
        if (e.srcElement.checked) {
            document.getElementById('plus-one-form').style.display = "block";
            document.getElementById('plus-one-full-name').required = true;
        } else {
            document.getElementById('plus-one-form').style.display = "none";
            document.getElementById('plus-one-full-name').required = false;
        }
    });

    document.getElementById('bringing-children').addEventListener('click', function(e) {
        if (e.srcElement.checked) {
            document.getElementById('children-form').style.display = "block";
            document.getElementById('children-full-names').required = true;
        } else {
            document.getElementById('children-form').style.display = "none";
            document.getElementById('children-full-names').required = false;
        }
    });

    document.getElementById('reset-rsvp-form').addEventListener('click', function(e) {
        document.getElementById('attending-form').style.display = "none";
        document.getElementById('plus-one-form').style.display = "none";
        document.getElementById('children-form').style.display = "none";
        document.getElementById('plus-one-full-name').required = false;
        document.getElementById('children-full-names').required = false;
    });
</script>